#!/usr/bin/env php
<?php
/**
 * Appfuel
 * Copyright (c) Robert Scott-Buccleuch <rsb.appfuel@gmail.com>
 * See LICENSE file at project root for details.
 */
use Appfuel\App\CliHandlerInterface;

/**
 * build-config: will generate a cached configuration file based on a 
 * build strategy.
 *
 * cli args: any argument will be considered a path to a config file to 
 *           process
 * short opts: 
 *  -s: [flag] single config file where enviroments are stored as keys
 *  -m: [flag] multiple config files given to merge
 *  -e: [opt]  name of the enviroment to build
 *  -t: [opt]  target to build when not specified it is assumed 'prod'
 *  -b: [opt]  location and name of the final build file, when not specified
 *             'app/build/config.json is assumed
 */
$base   = realpath(__DIR__ . "/../");
$header = "$base/app/app-header.php";
if (! file_exists($header)) {
    fwrite(STDERR, "could not find app header at -($header) \n");
    exit(-1);
}
/*
 * Used to control the app-header.php script. $appType gives us cli handler
 * and configAction tells the header to replace the config data with ours.
 * Since we are the building configuration data we can not rely on config
 * data to be arround, so we use our own values
 */
$ctrl = array(
    'paths' => array(
        'app-root' => '/some/path',
    ),
    'app-type'          => 'cli',
    'config-action'     => 'replace',
    'config-settings'   => array(
	    'php-error-level'			=> 'all strict',
	    'php-include-path'			=> array($base),
	    'php-include-path-replace'	=> 'replace',
	    'php-display-errors'		=> 'on',
	    'php-autoloader'			=> 'Appfuel\ClassLoader\StandardAutoloader',
	    'fault-handler-class'		=> 'Appfuel\Kernel\FaultHandler',
	    'php-default-timezone'		=> 'America/Los_Angeles'
    ),
);
$handler = require $header;
$input = $handler->createConsoleInput($_SERVER['argv']);
echo "\n", print_r($input->getArgs(),1), "\n";exit;

exit(0);
