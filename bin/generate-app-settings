#!/usr/bin/env php
<?php
/**
 * Appfuel
 * Copyright (c) Robert Scott-Buccleuch <rsb.appfuel@gmail.com>
 * See LICENSE file at project root for details.
 */
use Appfuel\Filesystem\FileHandler,
    Appfuel\Kernel\SettingsHandler,
    Symfony\Component\Yaml\Parser as YamlParser;

$console = require __DIR__ . '/cli-header.php';
$input = $console->createConsoleInput();
$fileHandler = new FileHandler();
$ymlParser = new YamlParser();

$settingsFile = $input->getFirstArg();
if (! $settingsFile) {
    $console->outputError("settings file must be specified as the first arg\n");
    exit(1);
}

$target = $input->getArg(1);
if (! $target) {
    $console->outputError("second arg must be path to the cache file\n");
    exit(1);
}

$settings = new SettingsHandler($fileHandler, $ymlParser);
$data = $settings->resolve($settingsFile);
$str = $settings->convert($data);
$settings->write($target, $str);

exit(0);
